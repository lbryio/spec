<!DOCTYPE html>
<html>
<head>
  <title>{{ site.title }}</title>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <link rel="stylesheet" type="text/css" href="normalize.css">
  <link rel="stylesheet" type="text/css" href="tocbot.css">
  <link rel="stylesheet" type="text/css" href="style.css">
</head>
<body>

  <main>
    <h1>LBRY: A Decentralized Digital Content Marketplace</h1>  
    <div class="toc-menu">Menu</div>
    <nav class="toc"></nav>
    <div id="content">
        {{ content }}
    </div>
  </main>

  <script src="https://hypothes.is/embed.js" async></script>

  <script src="tocbot.min.js"></script>
  <script>
    function ready(fn) {
      if (document.attachEvent ? document.readyState === "complete" : document.readyState !== "loading"){
        fn();
      } else {
        document.addEventListener('DOMContentLoaded', fn);
      }
    }

    function toggleClass(el, className) {
      if (el.classList) {
        el.classList.toggle(className);
      } else {
        var classes = el.className.split(' ');
        var existingIndex = classes.indexOf(className);

        if (existingIndex >= 0)
          classes.splice(existingIndex, 1);
        else
          classes.push(className);

        el.className = classes.join(' ');
      }
    }

    ready(function() {
      // Handle external links
      const links = document.links;
      for (var i = 0; i < links.length; i++) {
        if (links[i].hostname != window.location.hostname) {
          links[i].target = '_blank';
          links[i].className += ' external-link';
          links[i].rel = "noopener";
        }
      }


      // TOCbot
      var options = {
        tocSelector: '.toc',
        contentSelector: '#content',
        headingSelector: 'h2, h3, h4, h5, h6',
        collapseDepth: 3,
        positionFixedSelector: ".toc",
      };

      tocbot.init(options);

      document.querySelector('.toc-menu').addEventListener("click", function() {
        toggleClass(document.querySelector('.toc'), "open");
      });


      // need this part to fix toc offset height if content above toc changes height
      var resizeTimer;
      window.addEventListener('resize', function(e) {
        clearTimeout(resizeTimer);
        resizeTimer = setTimeout(function() {
          o = options;
          o.fixedSidebarOffset = "auto";
          tocbot.refresh(o);
        }, 250);
      });
    })
  </script>
</body>
</html>
